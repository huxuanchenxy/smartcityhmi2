import{_ as Ne,r as n,K as Q,I as ve,J as u,V as $e,c as F,e as o,b as l,w as i,i as y,F as Z,L as V,d as v,o as C,x as pe,t as D,y as I,s as ee,u as me,W as Ee,D as Pe,X as Re,N as Te}from"./index-CjguSdL3.js";import{a as Y,G as Fe}from"./energyApi-BelWF7_m.js";import{i as Ie}from"./index-CuDBRX2J.js";const Oe={class:"container"},Ae={class:"select-area"},Ge={class:"top-section"},je={class:"time-range-section"},Je={class:"content-area"},Ke={class:"scrollable-list"},We={class:"flex-container"},Xe={class:"image-container"},qe={class:"image-error"},He={class:"top-section2"},Qe={class:"top-section2"},Ze={class:"top-section2"},ea={key:0,class:"selected-info"},aa={class:"dialog-footer"},ta={__name:"index",setup(la){const B=n("");n(null);const N=n([]),ae=n([]),c=n(null);n(null);const r=n(""),g=n(""),p=n(""),k=Q({get(){if(p.value){const a=new Date(p.value);return a.setDate(a.getDate()+1),a}return null},set(a){console.warn("eldatetime3 是禁用状态，无法直接设置值")}}),f=n(""),w=n(""),O=n(""),A=n("");n(1e3);const S=n(80);n(""),n(!1),n("");const $=n(!1),E=n(""),M=n(105),P=n("");n("图片加载失败");const ce=Q(()=>{var a,e,s;return((a=x.value.datetimes)==null?void 0:a.length)>0&&((e=x.value.actuals)==null?void 0:e.length)>0&&((s=x.value.predicts)==null?void 0:s.length)>0});ve(async()=>{await ge()});const te=async()=>{r.value&&(_.value=1,X.value=0,f.value="",w.value="",await we(),await z(),u.success("成功加载 ".concat(le.value," 的数据")))},ge=async()=>{let a=await Y.nox_company();a.code==200?N.value=a.data:u.error("nox_company:"+a.msg)},fe=a=>{switch(a){case"trained":return"success";case"training":return"warning";default:return"info"}},le=Q(()=>{const a=N.value.find(e=>e.dictValue===r.value);return a?a.dictLabel:""});n([]);const z=async()=>{try{G.value=[];let a=f.value?V(f.value).format("YYYY-MM-DD"):"",e=w.value?V(w.value).format("YYYY-MM-DD"):"",s=await Y.trainpage({company:r.value,pageNum:_.value,pageSize:T.value,startDate:a,endDate:e});s.code==200?s.rows&&s.rows.length>0&&(X.value=s.total,G.value=s.rows.map((d,h)=>({...d,statusShow:d.status=="training"?"训练中":d.status=="trained"?"已训练":"未训练",trainStatus:d.status,startDate:d.startDate,endDate:d.endDate,createTime:d.createTime,predictBase64:d.predictBase64,importanceBase64:d.importanceBase64}))):u.error("trainpage:"+s.msg)}catch(a){u.error("trainpage:"+a.message)}finally{}},we=async()=>{let a=await Y.aodatelist({company:r.value});a.code==200?(j.value=[],a.data&&a.data.length>0&&a.data.forEach(e=>{j.value.push(e.date)})):u.error("加载可用时间段出错:"+a.msg)},G=n([]),j=n([]);function R(a){const e=V(a).format("YYYY-MM-DD");return!j.value.includes(e)}const J=n(!1),U=n(!1),K=n(null);let b=null;const W=n(!1),ye=a=>{E.value="权重分析",B.value=a.importanceBase64,$.value=!0},x=n({datetimes:["2023-12-09 00:00:00","2023-12-09 00:00:01","2023-12-09 00:00:02","2023-12-09 00:00:03"],actuals:["136.29754638671875","136.30165100097656","136.303955078125","136.3086700439453"],predicts:["136.29754638671875","136.30165100097656","136.303955078125","136.3086700439453"]}),be=()=>{Ce(x.value),W.value=!1},De=()=>{b&&(b.dispose(),b=null),ce.value=!1},Ve=async a=>{x.value={},O.value="暂无",A.value="暂无",E.value="预测结果",De();let e=await Y.predictChart({id:a.id});e.code==200&&e.data&&(e.data.datetimes&&e.data.actuals&&e.data.predicts?(x.value=e.data,P.value=ne(a.endDate),e.data.maes&&(O.value=e.data.maes[0],A.value=e.data.maes[1]),W.value=!0,J.value=!0):(P.value=ne(a.endDate),B.value=a.predictBase64,$.value=!0))},ne=a=>{const e=new Date(a);return e.setDate(e.getDate()+1),"".concat(e.getFullYear(),"/").concat(e.getMonth()+1,"/").concat(e.getDate())},Ce=a=>{if(console.log("chartRef.value data",a),!K.value||!a||!a.datetimes)return;b=Ie(K.value);const e={title:{text:"实际值与预测值对比",textStyle:{fontSize:16}},tooltip:{trigger:"axis",formatter:function(s){return"\n          时间: ".concat(s[0].axisValue,"<br/>\n          实际值: ").concat(s[0].data,"<br/>\n          预测值: ").concat(s[1].data,"\n        ")}},legend:{data:["实际值","预测值"]},xAxis:{type:"category",data:a.datetimes,axisLabel:{formatter:function(s){return s.split(" ")[1]}}},yAxis:{type:"value",name:"数值"},series:[{name:"实际值",type:"line",data:a.actuals.map(Number),smooth:!0,symbol:"circle",symbolSize:6,itemStyle:{color:"#5470C6"}},{name:"预测值",type:"line",data:a.predicts.map(Number),smooth:!0,symbol:"triangle",symbolSize:8,itemStyle:{color:"#EE6666"}}],grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0}};b.setOption(e)};ve(()=>{window.addEventListener("resize",oe)}),$e(()=>{b&&b.dispose(),window.removeEventListener("resize",oe)});const oe=()=>{b&&b.resize()},_=n(1),T=n(15),X=n(0),se=n(""),he=a=>{T.value=a,z()},xe=a=>{_.value=a,z()},_e=async()=>{if(!r.value){u.warning("请先选择工厂名称");return}if(!g.value){u.warning("请选择开始时间");return}if(!p.value){u.warning("请选择结束时间");return}if(g.value>=p.value){u.warning("结束时间要大于开始时间（2天及以上）");return}if(!c.value){u.warning("请选择算法");return}if(!S.value){u.warning("请输入训练次数");return}if(!M.value){u.warning("请输入时间跨度");return}try{await Te.confirm("确定要用 算法("+c.value.name+") 训练"+le.value+" ( "+M.value+" s)"+V(g.value).format("YYYY-MM-DD")+"至"+V(p.value).format("YYYY-MM-DD")+" 预测: ("+V(k.value).format("YYYY-MM-DD")+")"+S.value+"次 的数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});let a=[c.value.id],e={trainStartDate:V(g.value).format("YYYY-MM-DD"),trainEndDate:V(k.value).format("YYYY-MM-DD"),company:r.value,file:se.value,durationSecond:M.value,trainNo:S.value,algIds:a},s=await Y.executePythontrainv1(e);if(s.code==200&&(u.warning("已通知服务器开始训练，训练时间较长请耐心等待"),U.value=!1,s.data&&s.data.warnData&&s.data.warnData.length>0)){let d="数据监测异常提示: "+s.data.noxColumn+"连续出现 "+s.data.warnLineNumber+" 条以上重复数据！重复起始时间分别为："+s.data.warnData;u.error({message:d,duration:1e4})}await z(),se.value=""}catch(a){console.log("取消保存",a)}},Ye=async()=>{if(!r.value){u.warning("请先选择工厂");return}let a=await Y.alglist();a.code==200&&(ae.value=a.data),U.value=!0},ke=async()=>{if(!r.value){u.warning("请先选择工厂名称");return}if(f.value>w.value){u.warning("结束时间要大于等于开始时间");return}try{await z()}catch(a){console.log("取消保存",a)}};Fe();const ie=async()=>{if(!r.value){u.warning("请先选择工厂"),g.value="",p.value="";return}if(g.value&&p.value&&g.value>=p.value){u.warning("结束时间要大于开始时间（2天及以上）"),g.value="",p.value="";return}},ue=async()=>{if(!r.value){u.warning("请先选择工厂"),f.value="",w.value="";return}if(f.value&&w.value&&f.value>w.value){u.warning("开始时间不能大于结束时间"),f.value="",w.value="";return}};return(a,e)=>{const s=v("el-option"),d=v("el-select"),h=v("el-button"),L=v("el-date-picker"),m=v("el-table-column"),Se=v("el-tag"),re=v("el-table"),Me=v("el-pagination"),ze=v("el-card"),q=v("el-dialog"),Ue=v("el-icon"),Le=v("el-image"),de=v("el-input-number"),Be=v("el-checkbox");return C(),F(Z,null,[o("div",Oe,[o("div",Ae,[o("div",Ge,[e[19]||(e[19]=o("span",{class:"promptspan"},"工厂名称：",-1)),l(d,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),placeholder:"请选择工厂名称",onChange:te,clearable:"",filterable:""},{default:i(()=>[(C(!0),F(Z,null,pe(N.value,t=>(C(),I(s,{key:t.dictCode,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(h,{type:"primary",onClick:e[1]||(e[1]=t=>Ye())},{default:i(()=>e[18]||(e[18]=[y(" 新增训练任务 ")])),_:1})]),e[23]||(e[23]=o("div",{class:"time-range-section"},null,-1)),o("div",je,[e[21]||(e[21]=o("span",{class:"promptspan"},"筛选时间范围：",-1)),l(L,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),type:"date",placeholder:"开始时间",onFocus:ue,style:{width:"100%","max-width":"180px"},"disabled-date":R,align:"right"},null,8,["modelValue"]),e[22]||(e[22]=y(" 至 ")),l(L,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=t=>w.value=t),type:"date","disabled-date":R,placeholder:"结束时间",onFocus:ue,style:{width:"100%","max-width":"180px"},align:"right"},null,8,["modelValue"]),l(h,{type:"primary",onClick:e[4]||(e[4]=t=>ke()),title:"请选择1.工厂名称 2. 筛选时间范围"},{default:i(()=>e[20]||(e[20]=[y(" 筛选 ")])),_:1})])]),o("div",Je,[l(ze,{class:"original-list"},{header:i(()=>e[24]||(e[24]=[o("h2",null,"数据训练情况",-1)])),default:i(()=>[o("div",Ke,[l(re,{data:G.value,style:{width:"100%"},border:""},{default:i(()=>[l(m,{prop:"index",label:"序号",width:"60"},{default:i(({$index:t})=>[o("span",null,D(t+1+(_.value-1)*T.value)+".",1)]),_:1}),l(m,{prop:"startDate",label:"开始时间"}),l(m,{prop:"endDate",label:"结束时间"}),l(m,{prop:"algName",label:"算法名"}),l(m,{prop:"trainStatus",label:"状态"},{default:i(({row:t})=>[l(Se,{type:fe(t.trainStatus)},{default:i(()=>[y(D(t.statusShow),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"createTime",label:"训练时间"}),l(m,{label:"操作",width:"160"},{default:i(({row:t})=>[t.status=="trained"?(C(),I(h,{key:0,type:"primary",size:"small",onClick:H=>Ve(t)},{default:i(()=>e[25]||(e[25]=[y(" 预测图 ")])),_:2},1032,["onClick"])):ee("",!0),t.status=="trained"?(C(),I(h,{key:1,type:"primary",size:"small",onClick:H=>ye(t)},{default:i(()=>e[26]||(e[26]=[y(" 权重图 ")])),_:2},1032,["onClick"])):ee("",!0)]),_:1})]),_:1},8,["data"]),l(Me,{currentPage:_.value,"onUpdate:currentPage":e[5]||(e[5]=t=>_.value=t),"page-size":T.value,total:X.value,layout:"total,prev, pager, next",onSizeChange:he,onCurrentChange:xe},null,8,["currentPage","page-size","total"])])]),_:1})])]),l(q,{onOpened:be,loading:W.value,modelValue:J.value,"onUpdate:modelValue":e[6]||(e[6]=t=>J.value=t),title:E.value,width:"70%"},{default:i(()=>[o("div",We,[o("span",null,"预测日期: "+D(P.value),1),o("span",null,"预测和真实mae: "+D(O.value),1),o("span",null,"测量和真实mae: "+D(A.value),1)]),o("div",{ref_key:"chartRef",ref:K,style:{width:"100%",height:"680px"}},null,512)]),_:1},8,["loading","modelValue","title"]),l(q,{modelValue:$.value,"onUpdate:modelValue":e[7]||(e[7]=t=>$.value=t),title:E.value,width:"70%","before-close":a.handleClose},{default:i(()=>[o("div",Xe,[o("span",null,"预测日期:"+D(P.value),1),l(Le,{src:"data:image/png;base64,"+B.value,fit:"cover","preview-src-list":["data:image/png;base64,"+B.value]},{error:i(()=>[o("div",qe,[l(Ue,null,{default:i(()=>[l(me(Ee))]),_:1}),e[27]||(e[27]=o("span",null,"图片加载失败",-1))])]),_:1},8,["src","preview-src-list"])])]),_:1},8,["modelValue","title","before-close"]),l(q,{modelValue:U.value,"onUpdate:modelValue":e[17]||(e[17]=t=>U.value=t),title:"选择算法",width:"70%","before-close":a.handleClose},{footer:i(()=>[o("span",aa,[l(h,{onClick:e[15]||(e[15]=t=>U.value=!1)},{default:i(()=>e[34]||(e[34]=[y("取消")])),_:1}),l(h,{type:"primary",onClick:e[16]||(e[16]=t=>_e()),disabled:!c.value},{default:i(()=>e[35]||(e[35]=[y(" 训练 ")])),_:1},8,["disabled"])])]),default:i(()=>[o("div",He,[e[28]||(e[28]=o("span",{class:"promptspan"},"工厂名称：",-1)),l(d,{modelValue:r.value,"onUpdate:modelValue":e[8]||(e[8]=t=>r.value=t),placeholder:"请选择工厂名称",onChange:te,clearable:"",filterable:"",disabled:""},{default:i(()=>[(C(!0),F(Z,null,pe(N.value,t=>(C(),I(s,{key:t.dictCode,label:t.dictLabel,value:t.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),o("div",Qe,[e[29]||(e[29]=o("span",{class:"promptspan"},"训练时间范围：",-1)),l(L,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=t=>g.value=t),type:"date",placeholder:"开始时间",onFocus:ie,style:{width:"100%","max-width":"180px"},"disabled-date":R,align:"right"},null,8,["modelValue"]),e[30]||(e[30]=y(" 至 ")),l(L,{modelValue:p.value,"onUpdate:modelValue":e[10]||(e[10]=t=>p.value=t),type:"date","disabled-date":R,placeholder:"结束时间",onFocus:ie,style:{width:"100%","max-width":"180px"},align:"right"},null,8,["modelValue"]),e[31]||(e[31]=y(" 预测日期： ")),l(L,{modelValue:me(k),"onUpdate:modelValue":e[11]||(e[11]=t=>Pe(k)?k.value=t:null),type:"date",disabled:"",placeholder:"预测日期",style:{width:"100%","max-width":"180px"},align:"right"},null,8,["modelValue"])]),o("div",Ze,[e[32]||(e[32]=o("span",{class:"promptspan"},"次数：",-1)),l(de,{modelValue:S.value,"onUpdate:modelValue":e[12]||(e[12]=t=>S.value=t),min:1},null,8,["modelValue"]),e[33]||(e[33]=o("span",{class:"promptspan"},"时间跨度(s)：",-1)),l(de,{class:"duration-input",modelValue:M.value,"onUpdate:modelValue":e[13]||(e[13]=t=>M.value=t),placeholder:"Enter duration in seconds",min:1},null,8,["modelValue"])]),l(re,{data:ae.value,style:{width:"100%"},onRowClick:a.handleRowClick,"row-class-name":a.tableRowClassName,"highlight-current-row":""},{default:i(()=>[l(m,{width:"60"},{default:i(({row:t})=>[l(Be,{"model-value":c.value===t,onChange:H=>H?c.value=t:c.value=null,onClick:e[14]||(e[14]=Re(()=>{},["stop"]))},null,8,["model-value","onChange"])]),_:1}),l(m,{prop:"index",label:"序号",width:"60"},{default:i(({$index:t})=>[o("span",null,D(t+1)+".",1)]),_:1}),l(m,{prop:"name",label:"算法名称",width:"180"}),l(m,{prop:"remark",label:"备注"})]),_:1},8,["data","onRowClick","row-class-name"]),c.value?(C(),F("div",ea," 已选择: "+D(c.value.name)+" - (备注: "+D(c.value.remark)+") ",1)):ee("",!0)]),_:1},8,["modelValue","before-close"])],64)}}},ia=Ne(ta,[["__scopeId","data-v-5cea1d9f"]]);export{ia as default};
