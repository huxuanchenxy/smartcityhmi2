System.register(["./index-legacy-Cgp3PKn6.js","./vuedraggable.umd-legacy-VED34mcE.js","./energyApi-legacy-6I-V7-GA.js"],(function(e,a){"use strict";var l,t,n,i,o,d,s,c,r,u,m,v,p,g,f,y,x,h,b,w,V,k,_,Y,U,C,M,H,N;return{setters:[e=>{l=e._,t=e.r,n=e.I,i=e.J,o=e.K,d=e.c,s=e.b,c=e.w,r=e.e,u=e.i,m=e.t,v=e.s,p=e.L,g=e.M,f=e.N,y=e.d,x=e.o,h=e.F,b=e.x,w=e.u,V=e.A,k=e.O,_=e.y,Y=e.P,U=e.Q,C=e.U},e=>{M=e.d},e=>{H=e.a,N=e.G}],execute:function(){var a=document.createElement("style");a.textContent=".container[data-v-424ee317]{margin:0 auto;padding:0;font-family:Helvetica Neue,Helvetica,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif}.page-header[data-v-424ee317]{margin-bottom:20px}h1[data-v-424ee317],h2[data-v-424ee317]{color:#303133;margin:0}.select-area[data-v-424ee317]{display:flex;align-items:center;gap:10px;padding-top:10px}.select-area .promptspan[data-v-424ee317],.select-area .duration-input[data-v-424ee317]{width:100px}.select-area .el-select[data-v-424ee317]{width:150px}.content-area[data-v-424ee317]{display:flex;gap:20px;margin-top:20px}.original-list[data-v-424ee317],.editable-list[data-v-424ee317]{flex:1}.button-area[data-v-424ee317]{margin-top:20px;display:flex;gap:10px}.loading-content[data-v-424ee317]{display:flex;flex-direction:column;align-items:center;padding:20px}.loading-text[data-v-424ee317]{margin-top:20px;font-size:16px;color:#606266}.drag-handle[data-v-424ee317]{cursor:move}.scrollable-list[data-v-424ee317]{max-height:600px;overflow-y:auto}.draggable-item[data-v-424ee317]{display:flex;align-items:center;padding:8px 15px;margin:5px 0;background-color:#fff;border:1px solid #ebeef5;border-radius:4px;transition:all .3s;cursor:move}.draggable-item-disabled[data-v-424ee317]{display:flex;align-items:center;padding:8px 15px;margin:5px 0;background-color:#fff;border:1px solid #ebeef5;border-radius:4px;transition:all .3s}.draggable-item[data-v-424ee317]:hover{background-color:#f5f7fa}.drag-handle[data-v-424ee317]{margin-right:10px;cursor:move;color:#909399}.item-index[data-v-424ee317]{margin-right:0;color:#606266;min-width:20px}.item-name[data-v-424ee317]{flex:1;color:#303133}.sortable-chosen[data-v-424ee317]{background-color:#b0b1b3}.sortable-ghost[data-v-424ee317]{opacity:.5;background:#a1d4ec}.item-content[data-v-424ee317]{display:flex;align-items:center;width:100%;gap:8px}.edit-input[data-v-424ee317]{flex:1;margin-right:10px}.item-actions[data-v-424ee317]{margin-left:auto;white-space:nowrap}.switch-container[data-v-424ee317]{display:flex;justify-content:space-between;align-items:center;gap:10px;height:16px}.right-group[data-v-424ee317]{display:flex;align-items:center;gap:10px}[data-v-424ee317] .cell-content{position:relative;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}[data-v-424ee317] .green-dot{display:block;width:6px;height:6px;margin-top:2px;background-color:#67c23a;border-radius:50%}\n",document.head.appendChild(a);const D={class:"container"},L={class:"loading-content"},j={class:"loading-text"},E={class:"select-area"},S={class:"content-area"},T={class:"scrollable-list"},$={class:"draggable-item-disabled"},I={class:"item-index"},R={class:"item-name"},z={class:"switch-container"},B={class:"right-group"},A={class:"scrollable-list"},K={class:"draggable-item"},O={class:"item-content"},P={class:"item-index"},F={key:0,class:"item-name"},G={class:"item-actions"},J={class:"button-area"},Q={key:0},q={__name:"index",setup(e){let a=t(null);const l=t([]),q=t(105);t("");const W=t(!0),X=t(""),Z=t([]),ee=t([]),ae=t([]),le=t(!1),te=t(!1),ne=t(null),ie=t(0),oe=t(""),de=t("处理中，请稍候..."),se=t("");n((async()=>{await ce()}));const ce=async()=>{let e=await H.nox_company();200==e.code?l.value=e.data:i.error("nox_company:"+e.msg)},re=e=>{ae.value&&ae.value.forEach((a=>{a.active=e}))},ue=o((()=>{const e=l.value.find((e=>e.dictValue===X.value));return e?e.dictLabel:""})),me=t(!0),ve=async()=>{X.value&&(await ge(),await pe(),i.success(`成功加载 ${ue.value} 的数据`))},pe=async()=>{let e=await H.aodatelist({company:X.value});200==e.code?(Ue.value=[],e.data&&e.data.length>0&&e.data.forEach((e=>{Ue.value.push(e.date)}))):i.error("加载可用时间段出错:"+e.msg)},ge=async()=>{await(async()=>{let e=await H.csvmap({company:X.value});200==e.code?Z.value=e.data:i.error("csvmap:"+e.msg)})(),ee.value=Z.value.map(((e,a)=>({name:e.colName,no:e.no,active:"1"==e.status.toString()}))),ae.value=Z.value.map(((e,a)=>({id:e.id,name:e.colName,no:e.no,col:e.col,editing:!1,editName:"",active:"1"==e.status.toString(),sort:e.sort,company:e.company,type:e.type,status:e.status})))},fe=e=>{e.editName.trim()?(e.name=e.editName,e.editing=!1):i.warning("名称不能为空")},ye=async e=>{const a=e.target.files[0];if(!a)return;te.value=!0,de.value=`正在导入 ${a.name}...`,ie.value=0,oe.value="";const l=setInterval((()=>{ie.value+=Math.floor(5*Math.random())+1,ie.value>=100&&(clearInterval(l),ie.value=100,oe.value="success",de.value="导入完成!",setTimeout((()=>{e.target.value="",te.value=!1,le.value=!1,i.success(`成功导入 ${a.name}`)}),1e3))}),100)},xe=t(!1);let he=N();const be=async()=>{if(!X.value)return void i.warning("请先选择工厂名称");if(!ke.value)return void i.warning("请选择开始时间");if(!_e.value)return void i.warning("请选择结束时间");if(ke.value>=_e.value)return void i.warning("结束时间要大于开始时间");let e=await H.validateExport({startTime:p(ke.value).format("YYYY-MM-DD HH:mm:ss"),endTime:p(_e.value).format("YYYY-MM-DD HH:mm:ss"),company:X.value});if(e&&0==e.data)i.warning("你选择的时间内无数据，请重新选择时间！");else{xe.value=!0;try{a.value=g.service({fullscreen:!0,lock:!0,text:"数据加载中....",background:"rgba(0, 0, 0, 0.1)"});const e=new URLSearchParams({startTime:p(ke.value).format("YYYY-MM-DD HH:mm:ss"),endTime:p(_e.value).format("YYYY-MM-DD HH:mm:ss"),company:X.value,durationSecond:q.value}),t=await fetch(he+`/noxao/toCsv?${e}`);if(!t.ok){let e=`服务器错误: ${t.status}`;console.log("errorMessage:",e);try{const a=await t.json();a.message&&(e=a.message)}catch(l){console.error("解析错误信息失败:",l)}throw new Error(e)}const n=t.headers.get("Content-Length"),i=n?parseInt(n):null;let o=0;const d=t.body.getReader(),s=[];for(;;){const{done:e,value:a}=await d.read();if(e)break;if(s.push(a),o+=a.length,i){const e=Math.round(o/i*100);se.value=`下载进度: ${e}%`}}const c=new Blob(s),r=URL.createObjectURL(c),u=document.createElement("a");u.href=r,u.download=ue.value+".csv",u.click(),URL.revokeObjectURL(r)}catch(t){console.error("下载失败:",t),i.error("导出失败，失败原因："+t)}finally{xe.value=!1,a.value.close(),se.value=""}}},we=async()=>{if(X.value)try{await f.confirm("确定要保存当前列表的更改吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),ae.value=ae.value.map(((e,a)=>({id:e.id,colName:e.name,col:e.col,active:e.active,sort:a+1,company:e.company,type:e.type,status:e.active?"1":"0"}))),200==(await H.csvmapall(ae.value)).code&&(i.success(`成功保存 ${ue.value} 的数据`),ge())}catch(e){console.log("取消保存",e)}else i.warning("请先选择工厂名称")},Ve=()=>{},ke=t(""),_e=t(""),Ye=async()=>{if(ke.value&&_e.value&&ke.value>=_e.value)return i.warning("开始时间不能大于结束时间"),ke.value="",void(_e.value="")},Ue=t([]);function Ce(e){const a=p(e).format("YYYY-MM-DD");return!Ue.value.includes(a)}return(e,a)=>{const t=y("el-progress"),n=y("el-dialog"),i=y("el-option"),o=y("el-select"),p=y("el-date-picker"),g=y("el-input"),f=y("el-switch"),H=y("el-card"),N=y("el-icon"),Z=y("el-button");return x(),d("div",D,[s(n,{modelValue:le.value,"onUpdate:modelValue":a[0]||(a[0]=e=>le.value=e),title:"处理中",width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{default:c((()=>[r("div",L,[s(t,{type:"circle",percentage:ie.value,status:oe.value},null,8,["percentage","status"]),r("p",j,m(de.value),1)])])),_:1},8,["modelValue"]),r("div",E,[a[8]||(a[8]=r("span",{class:"promptspan"},"工厂名称：",-1)),s(o,{modelValue:X.value,"onUpdate:modelValue":a[1]||(a[1]=e=>X.value=e),placeholder:"请选择工厂名称",onChange:ve,clearable:"",filterable:""},{default:c((()=>[(x(!0),d(h,null,b(l.value,(e=>(x(),_(i,{key:e.dictCode,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),a[9]||(a[9]=r("span",{class:"promptspan"},"时间范围：",-1)),s(p,{modelValue:ke.value,"onUpdate:modelValue":a[2]||(a[2]=e=>ke.value=e),type:"datetime",placeholder:"开始时间",style:{width:"100%","max-width":"180px"},"disabled-date":Ce,align:"right"},null,8,["modelValue"]),a[10]||(a[10]=u(" 至 ")),s(p,{modelValue:_e.value,"onUpdate:modelValue":a[3]||(a[3]=e=>_e.value=e),type:"datetime","disabled-date":Ce,placeholder:"结束时间",onChange:Ye,style:{width:"100%","max-width":"180px"},align:"right"},null,8,["modelValue"]),a[11]||(a[11]=r("span",{class:"promptspan"},"时间跨度(s)：",-1)),s(g,{class:"duration-input",modelValue:q.value,"onUpdate:modelValue":a[4]||(a[4]=e=>q.value=e),placeholder:"Enter duration in seconds",type:"number"},null,8,["modelValue"])]),r("div",S,[s(H,{class:"original-list"},{header:c((()=>a[12]||(a[12]=[r("h2",null,"变更前的列",-1)]))),default:c((()=>[r("div",T,[s(w(M),{modelValue:ee.value,"onUpdate:modelValue":a[5]||(a[5]=e=>ee.value=e),"item-key":"id",class:V({"disabled-drag":W.value}),disabled:W.value},{item:c((({element:e,index:a})=>[r("div",$,[r("span",I,m(a+1)+".",1),r("span",R,m(e.name)+"("+m(e.no)+")",1),s(f,{modelValue:e.active,"onUpdate:modelValue":a=>e.active=a,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])])),_:1},8,["modelValue","class","disabled"])])])),_:1}),s(H,{class:"editable-list"},{header:c((()=>[r("div",z,[a[14]||(a[14]=r("h2",null,"变更后的列",-1)),r("div",B,[a[13]||(a[13]=r("span",null,"一键全部开启或关闭",-1)),s(f,{modelValue:me.value,"onUpdate:modelValue":a[6]||(a[6]=e=>me.value=e),onChange:re},null,8,["modelValue"])])])])),default:c((()=>[r("div",A,[s(w(M),{modelValue:ae.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ae.value=e),"item-key":"id",onEnd:Ve},{item:c((({element:e,index:l})=>[r("div",K,[s(N,{class:"drag-handle"},{default:c((()=>[s(w(k))])),_:1}),r("div",O,[r("span",P,m(l+1)+".",1),e.editing?(x(),_(g,{key:1,modelValue:e.editName,"onUpdate:modelValue":a=>e.editName=a,size:"small",onKeyup:Y((a=>fe(e)),["enter"]),style:{flex:"1","margin-right":"10px"},class:"edit-input"},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(x(),d("span",F,m(e.name)+"("+m(e.no)+") ",1)),r("div",G,[e.editing?(x(),d(h,{key:1},[s(Z,{type:"text",size:"small",onClick:a=>fe(e)},{default:c((()=>a[16]||(a[16]=[u(" 确认 ")]))),_:2},1032,["onClick"]),s(Z,{type:"text",size:"small",onClick:a=>{e.editing=!1}},{default:c((()=>a[17]||(a[17]=[u(" 取消 ")]))),_:2},1032,["onClick"])],64)):(x(),_(Z,{key:0,type:"text",size:"small",onClick:a=>{return(l=e).editing=!0,void(l.editName=l.name);var l}},{default:c((()=>a[15]||(a[15]=[u(" 编辑 ")]))),_:2},1032,["onClick"])),s(f,{modelValue:e.active,"onUpdate:modelValue":a=>e.active=a},null,8,["modelValue","onUpdate:modelValue"])])])])])),_:1},8,["modelValue"])])])),_:1})]),r("div",J,[s(Z,{type:"success",onClick:be,loading:xe.value},{default:c((()=>[s(N,{class:"el-icon--left"},{default:c((()=>[s(w(U))])),_:1}),a[18]||(a[18]=u(" 导出并下载 "))])),_:1},8,["loading"]),xe.value?(x(),d("span",Q,m(se.value),1)):v("",!0),s(Z,{type:"warning",onClick:we},{default:c((()=>[s(N,{class:"el-icon--left"},{default:c((()=>[s(w(C))])),_:1}),a[19]||(a[19]=u(" 保存 "))])),_:1}),r("input",{type:"file",ref_key:"fileInput",ref:ne,onChange:ye,accept:".csv",style:{display:"none"}},null,544)])])}}};e("default",l(q,[["__scopeId","data-v-424ee317"]]))}}}));
