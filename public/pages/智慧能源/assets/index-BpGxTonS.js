import{a as r}from"./energyApi-BelWF7_m.js";import{_ as R,r as s,K as W,I as $,J as u,c as g,e as p,b as t,w as o,d,o as c,F as B,x as I,i as _,t as F,N as X,y as L}from"./index-CjguSdL3.js";const Y={class:"container"},Z={class:"select-area"},h={class:"content-area"},ee={class:"dialog-footer"},le={__name:"index",setup(ae){s("");const x=s([]),m=s(!1),b=s(!1),U=s(null),C=s([]),i=s(""),M=W(()=>{const a=C.value.find(e=>e.dictValue===i.value);return a?a.dictLabel:""});$(async()=>{await z()});const T=async()=>{i.value&&(await y(),await k(i.value),u.success("成功加载 ".concat(M.value," 的数据")))},z=async()=>{let a=await r.nox_company();a.code==200?(C.value=a.data,D.value=a.data):u.error("nox_company:"+a.msg)},y=async()=>{let a=await r.rulelist({company:i.value});a.code==200?(x.value=[],a.data&&a.data.length>0&&(x.value=a.data.map((e,V)=>({...e})))):u.error("加载规则报错:"+a.msg)},n=s({company:"",colName:"",symbol:"",value:"",colId:""}),D=s([]),E=s([]);$(()=>{});const k=async a=>{let e=await r.csvmap({company:a});e.code==200?E.value=e.data:u.error("csvmap:"+e.msg)};function O(){if(!i.value){u.warning("请先选择工厂名称");return}b.value=!1,U.value=null,n.value={company:i.value,colName:"",symbol:"",value:"",colId:""},m.value=!0}const S=async a=>{b.value=!0,U.value=a.id,await k(a.company);let e=await r.ruleSingle({id:a.id});e.code==200&&(n.value={...e.data},m.value=!0)},A=async a=>{X.confirm("确定要删除这条数据吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{r.ruledel({id:a.id}).then(e=>{e.code==200?(u.success("删除成功"),y()):u.error("删除失败")})}).catch(()=>{u.info("已取消删除")})},J=async a=>{await k(a)},K=async()=>{b.value?(await r.ruleupdate(n.value)).code==200&&(u.success("修改成功"),y()):(await r.ruleadd(n.value)).code==200&&(u.success("新增成功"),y()),m.value=!1};return(a,e)=>{const V=d("el-option"),N=d("el-select"),v=d("el-button"),f=d("el-table-column"),j=d("el-table"),q=d("el-card"),w=d("el-form-item"),P=d("el-input"),G=d("el-form"),H=d("el-dialog");return c(),g("div",Y,[p("div",Z,[e[8]||(e[8]=p("span",{class:"promptspan"},"工厂名称：",-1)),t(N,{class:"promptsel",modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value=l),placeholder:"请选择工厂名称",onChange:T,clearable:"",filterable:""},{default:o(()=>[(c(!0),g(B,null,I(C.value,l=>(c(),L(V,{key:l.dictCode,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(v,{type:"primary",onClick:O},{default:o(()=>e[7]||(e[7]=[_("新增规则")])),_:1})]),p("div",h,[t(q,{class:"original-list"},{default:o(()=>[t(j,{data:x.value,border:"",style:{width:"100%"}},{default:o(()=>[t(f,{prop:"index",label:"序号",width:"60"},{default:o(({$index:l})=>[p("span",null,F(l+1),1)]),_:1}),t(f,{prop:"col_name",label:"列名"},{default:o(l=>[p("span",null,F(l.row.colName),1)]),_:1}),t(f,{prop:"symbol",label:"判断条件"}),t(f,{prop:"value",label:"值"}),t(f,{label:"操作",width:"150"},{default:o(l=>[t(v,{size:"small",onClick:Q=>S(l.row)},{default:o(()=>e[9]||(e[9]=[_("修改")])),_:2},1032,["onClick"]),t(v,{size:"small",type:"danger",onClick:Q=>A(l.row)},{default:o(()=>e[10]||(e[10]=[_("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),t(H,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=l=>m.value=l),title:b.value?"编辑规则":"新增规则",width:"50%"},{footer:o(()=>[p("span",ee,[t(v,{onClick:e[5]||(e[5]=l=>m.value=!1)},{default:o(()=>e[11]||(e[11]=[_("取消")])),_:1}),t(v,{type:"primary",onClick:K},{default:o(()=>e[12]||(e[12]=[_("确定")])),_:1})])]),default:o(()=>[t(G,{model:n.value,"label-width":"120px"},{default:o(()=>[t(w,{label:"工厂"},{default:o(()=>[t(N,{modelValue:n.value.company,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.company=l),placeholder:"请选择工厂",onChange:J,disabled:!0},{default:o(()=>[(c(!0),g(B,null,I(D.value,l=>(c(),L(V,{key:l.dictCode,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"列名"},{default:o(()=>[t(N,{modelValue:n.value.colId,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.colId=l),placeholder:"请选择列名"},{default:o(()=>[(c(!0),g(B,null,I(E.value,l=>(c(),L(V,{key:l.id,label:l.colName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"判断条件"},{default:o(()=>[t(P,{modelValue:n.value.symbol,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.symbol=l)},null,8,["modelValue"])]),_:1}),t(w,{label:"值"},{default:o(()=>[t(P,{modelValue:n.value.value,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.value=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ne=R(le,[["__scopeId","data-v-fa426949"]]);export{ne as default};
