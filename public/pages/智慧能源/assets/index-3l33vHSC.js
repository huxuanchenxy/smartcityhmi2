import{a as _,G as re}from"./energyApi-BelWF7_m.js";import{_ as de,r as u,K as ie,I as j,J as s,c as U,e as d,b as t,w as o,d as r,o as g,F as N,x as q,i as b,t as y,y as S,N as ce}from"./index-CjguSdL3.js";const pe={class:"container"},me={class:"select-area"},ve={class:"content-area"},fe={class:"el-upload__tip"},_e={class:"dialog-footer"},ge={__name:"index",setup(be){u("");const k=u([]),p=u(!1),V=u(!1),B=u(null),z=u([]),i=u(""),P=ie(()=>{const l=z.value.find(e=>e.dictValue===i.value);return l?l.dictLabel:""});j(async()=>{await A()});const $=async()=>{i.value&&(await w(),s.success("成功加载 ".concat(P.value," 的数据")))},A=async()=>{let l=await _.nox_company();l.code==200?(z.value=l.data,D.value=l.data):s.error("nox_company:"+l.msg)},w=async()=>{let l=await _.ruleSpeclist({company:i.value});l.code==200?(k.value=[],l.data&&l.data.length>0&&(k.value=l.data.map((e,c)=>({...e})))):s.error("加载特殊规则报错:"+l.msg)},n=u({id:"",company:"",ruleKey:"",description:""}),D=u([]);u([]),j(()=>{});function I(){if(!i.value){s.warning("请先选择工厂名称");return}V.value=!1,B.value=null,n.value={company:i.value,col_name:"",symbol:"",value:""},x.value="",p.value=!0}const K=async l=>{V.value=!0,B.value=l.id;let e=await _.ruleSpecSingle({id:l.id});e.code==200&&(n.value={...e.data},e.data.url&&(x.value=e.data.url,n.value.algorithmFile=e.data.url),p.value=!0)},M=async l=>{ce.confirm("确定要删除这条数据吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_.ruleSpecdel({id:l.id}).then(e=>{e.code==200?(s.success("删除成功"),w()):s.error("删除失败")})}).catch(()=>{s.info("已取消删除")})},R=async l=>{},T=async()=>{await h.value.validate(),V.value?(await _.ruleSpecupdate(n.value)).code==200&&(s.success("修改成功"),w()):(await _.ruleSpecadd(n.value)).code==200&&(s.success("新增成功"),w()),p.value=!1},h=u(null);let G=re();const W=u(G+"/ruleSpec/upload"),F=u([]),L=u(Date.now()),x=u(""),H=u({Authorization:"Bearer your_token_here"}),J=u({type:"ruleSpec"}),O={name:[{required:!0,message:"请输入算法名称",trigger:"blur"}],method:[{required:!0,message:"请输入方法名",trigger:"blur"}],clazz:[{required:!0,message:"请输入类名",trigger:"blur"}],algorithmFile:[{required:!0,message:"请上传特殊规则文件",trigger:"change"}]},Q=l=>(X(),l.name.endsWith(".jar")?!0:(s.error("只能上传.jar文件"),!1)),X=()=>{F.value=[],L.value=Date.now()},Y=(l,e,c)=>{l.code===200?(s.success("上传成功"),c.value=[{name:l.data,url:l.data,status:"success",percentage:100}],console.log("fileList:",c.value),x.value=l.data,n.value.url=l.data):s.error(l.message||"上传失败")},Z=(l,e,c)=>{console.error("上传失败:",l),s.error("文件上传失败")},ee=l=>{if(!l.raw.name.endsWith(".jar"))return s.error("只能上传.jar文件"),!1;n.value.algorithmFile=l.raw,h.value.validateField("algorithmFile",e=>{})},le=()=>{F.value=[],n.value.algorithmFile=null,console.log(n.value),h.value.validateField("algorithmFile")};return(l,e)=>{const c=r("el-option"),E=r("el-select"),m=r("el-button"),v=r("el-table-column"),ae=r("el-table"),te=r("el-card"),f=r("el-form-item"),C=r("el-input"),oe=r("el-upload"),ne=r("el-form"),ue=r("el-dialog");return g(),U("div",pe,[d("div",me,[e[9]||(e[9]=d("span",{class:"promptspan"},"工厂名称：",-1)),t(E,{class:"promptsel",modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),placeholder:"请选择工厂名称",onChange:$,clearable:"",filterable:""},{default:o(()=>[(g(!0),U(N,null,q(z.value,a=>(g(),S(c,{key:a.dictCode,label:a.dictLabel,value:a.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(m,{type:"primary",onClick:I},{default:o(()=>e[8]||(e[8]=[b("新增特殊规则")])),_:1})]),d("div",ve,[t(te,{class:"original-list"},{default:o(()=>[t(ae,{data:k.value,border:"",style:{width:"100%"}},{default:o(()=>[t(v,{prop:"index",label:"序号",width:"60"},{default:o(({$index:a})=>[d("span",null,y(a+1)+".",1)]),_:1}),t(v,{prop:"name",label:"名称"},{default:o(a=>[d("span",null,y(a.row.name),1)]),_:1}),t(v,{prop:"clazz",label:"类名"},{default:o(a=>[d("span",null,y(a.row.clazz),1)]),_:1}),t(v,{prop:"method",label:"方法名"},{default:o(a=>[d("span",null,y(a.row.method),1)]),_:1}),t(v,{prop:"description",label:"描述"},{default:o(a=>[d("span",null,y(a.row.description),1)]),_:1}),t(v,{label:"操作",width:"150"},{default:o(a=>[t(m,{size:"small",onClick:se=>K(a.row)},{default:o(()=>e[10]||(e[10]=[b("修改")])),_:2},1032,["onClick"]),t(m,{size:"small",type:"danger",onClick:se=>M(a.row)},{default:o(()=>e[11]||(e[11]=[b("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),t(ue,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=a=>p.value=a),title:V.value?"编辑特殊规则":"新增特殊规则",width:"50%"},{footer:o(()=>[d("span",_e,[t(m,{onClick:e[6]||(e[6]=a=>p.value=!1)},{default:o(()=>e[13]||(e[13]=[b("取消")])),_:1}),t(m,{type:"primary",onClick:T},{default:o(()=>e[14]||(e[14]=[b("确定")])),_:1})])]),default:o(()=>[t(ne,{model:n.value,"label-width":"120px",rules:O,ref_key:"formRef",ref:h},{default:o(()=>[t(f,{label:"工厂"},{default:o(()=>[t(E,{modelValue:n.value.company,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.company=a),placeholder:"请选择工厂",onChange:R,disabled:!0},{default:o(()=>[(g(!0),U(N,null,q(D.value,a=>(g(),S(c,{key:a.dictCode,label:a.dictLabel,value:a.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"名称",prop:"name"},{default:o(()=>[t(C,{modelValue:n.value.name,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.name=a)},null,8,["modelValue"])]),_:1}),t(f,{label:"类名",prop:"clazz"},{default:o(()=>[t(C,{modelValue:n.value.clazz,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.clazz=a)},null,8,["modelValue"])]),_:1}),t(f,{label:"方法",prop:"method"},{default:o(()=>[t(C,{modelValue:n.value.method,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.method=a)},null,8,["modelValue"])]),_:1}),t(f,{label:"规则文件：",prop:"algorithmFile"},{default:o(()=>[(g(),S(oe,{class:"upload-demo",action:W.value,headers:H.value,data:J.value,"before-upload":Q,"on-success":Y,"on-error":Z,"on-change":ee,"on-remove":le,limit:1,"file-list":F.value,accept:".jar","auto-upload":!0,key:L.value},{trigger:o(()=>[t(m,{type:"primary"},{default:o(()=>e[12]||(e[12]=[b("上传文件")])),_:1})]),tip:o(()=>[d("div",fe," 服务器训练文件:"+y(x.value),1)]),_:1},8,["action","headers","data","file-list"]))]),_:1}),t(f,{label:"描述"},{default:o(()=>[t(C,{modelValue:n.value.description,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.description=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},we=de(ge,[["__scopeId","data-v-0eb1796b"]]);export{we as default};
