System.register(["./index-legacy-Cgp3PKn6.js","./energyApi-legacy-6I-V7-GA.js","./index-legacy-rjMJFdgK.js"],(function(e,a){"use strict";var l,t,n,i,d,o,u,s,r,c,p,v,m,g,f,y,w,h,x,b,V,D,Y,C,_,k,M;return{setters:[e=>{l=e._,t=e.r,n=e.K,i=e.I,d=e.J,o=e.V,u=e.c,s=e.e,r=e.b,c=e.w,p=e.i,v=e.F,m=e.L,g=e.d,f=e.o,y=e.x,w=e.t,h=e.y,x=e.s,b=e.u,V=e.W,D=e.D,Y=e.X,C=e.N},e=>{_=e.a,k=e.G},e=>{M=e.i}],execute:function(){var a=document.createElement("style");a.textContent=".container[data-v-5cea1d9f]{margin:0 auto;padding:0;font-family:Helvetica Neue,Helvetica,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif}.page-header[data-v-5cea1d9f]{margin-bottom:20px}h1[data-v-5cea1d9f],h2[data-v-5cea1d9f]{color:#303133;margin:0}.select-area[data-v-5cea1d9f]{display:flex;align-items:center;gap:10px;padding-top:10px}.select-area[data-v-5cea1d9f]{display:flex;flex-direction:column;align-items:flex-start;gap:10px;padding-top:10px}.top-section[data-v-5cea1d9f]{display:flex;align-items:center;gap:10px}.time-range-section[data-v-5cea1d9f]{display:flex;gap:8px;align-items:center}.time-range-item[data-v-5cea1d9f]{display:flex;align-items:center;gap:10px}.select-area .duration-input[data-v-5cea1d9f]{width:100px}.select-area .el-select[data-v-5cea1d9f],.top-section2 .el-select[data-v-5cea1d9f],.top-section2 .el-input[data-v-5cea1d9f]{width:110px}.top-section2[data-v-5cea1d9f]{height:40px}.content-area[data-v-5cea1d9f]{display:flex;gap:20px;margin-top:20px;width:100%}.original-list[data-v-5cea1d9f],.editable-list[data-v-5cea1d9f]{flex:1}.button-area[data-v-5cea1d9f]{margin-top:20px;display:flex;gap:10px}.loading-content[data-v-5cea1d9f]{display:flex;flex-direction:column;align-items:center;padding:20px}.loading-text[data-v-5cea1d9f]{margin-top:20px;font-size:16px;color:#606266}.drag-handle[data-v-5cea1d9f]{cursor:move}.item-content[data-v-5cea1d9f]{display:flex;align-items:center;width:100%;gap:8px}.flex-container[data-v-5cea1d9f]{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;align-items:center;gap:15px;position:relative;left:5px;bottom:5px}.empty-placeholder[data-v-5cea1d9f]{display:flex;flex-direction:column;align-items:center;justify-content:center;color:#999;font-size:14px}.selected-info[data-v-5cea1d9f]{margin-top:20px}\n",document.head.appendChild(a);const S={class:"container"},z={class:"select-area"},U={class:"top-section"},B={class:"time-range-section"},L={class:"content-area"},N={class:"scrollable-list"},$={class:"flex-container"},E={class:"image-container"},F={class:"image-error"},j={class:"top-section2"},R={class:"top-section2"},P={class:"top-section2"},T={key:0,class:"selected-info"},A={class:"dialog-footer"};e("default",l({__name:"index",setup(e){const a=t("");t(null);const l=t([]),H=t([]),I=t(null);t(null);const G=t(""),O=t(""),J=t(""),K=n({get(){if(J.value){const e=new Date(J.value);return e.setDate(e.getDate()+1),e}return null},set(e){console.warn("eldatetime3 是禁用状态，无法直接设置值")}}),W=t(""),X=t(""),q=t(""),Q=t("");t(1e3);const Z=t(80);t(""),t(!1),t("");const ee=t(!1),ae=t(""),le=t(105),te=t("");t("图片加载失败");const ne=n((()=>he.value.datetimes?.length>0&&he.value.actuals?.length>0&&he.value.predicts?.length>0));i((async()=>{await de()}));const ie=async()=>{G.value&&(Ce.value=1,ke.value=0,W.value="",X.value="",await re(),await se(),d.success(`成功加载 ${ue.value} 的数据`))},de=async()=>{let e=await _.nox_company();200==e.code?l.value=e.data:d.error("nox_company:"+e.msg)},oe=e=>{switch(e){case"trained":return"success";case"training":return"warning";default:return"info"}},ue=n((()=>{const e=l.value.find((e=>e.dictValue===G.value));return e?e.dictLabel:""}));t([]);const se=async()=>{try{ce.value=[];let e=W.value?m(W.value).format("YYYY-MM-DD"):"",a=X.value?m(X.value).format("YYYY-MM-DD"):"",l=await _.trainpage({company:G.value,pageNum:Ce.value,pageSize:_e.value,startDate:e,endDate:a});200==l.code?l.rows&&l.rows.length>0&&(ke.value=l.total,ce.value=l.rows.map(((e,a)=>({...e,statusShow:"training"==e.status?"训练中":"trained"==e.status?"已训练":"未训练",trainStatus:e.status,startDate:e.startDate,endDate:e.endDate,createTime:e.createTime,predictBase64:e.predictBase64,importanceBase64:e.importanceBase64})))):d.error("trainpage:"+l.msg)}catch(e){d.error("trainpage:"+e.message)}},re=async()=>{let e=await _.aodatelist({company:G.value});200==e.code?(pe.value=[],e.data&&e.data.length>0&&e.data.forEach((e=>{pe.value.push(e.date)}))):d.error("加载可用时间段出错:"+e.msg)},ce=t([]),pe=t([]);function ve(e){const a=m(e).format("YYYY-MM-DD");return!pe.value.includes(a)}const me=t(!1),ge=t(!1),fe=t(null);let ye=null;const we=t(!1),he=t({datetimes:["2023-12-09 00:00:00","2023-12-09 00:00:01","2023-12-09 00:00:02","2023-12-09 00:00:03"],actuals:["136.29754638671875","136.30165100097656","136.303955078125","136.3086700439453"],predicts:["136.29754638671875","136.30165100097656","136.303955078125","136.3086700439453"]}),xe=()=>{De(he.value),we.value=!1},be=async e=>{he.value={},q.value="暂无",Q.value="暂无",ae.value="预测结果",ye&&(ye.dispose(),ye=null),ne.value=!1;let l=await _.predictChart({id:e.id});200==l.code&&l.data&&(l.data.datetimes&&l.data.actuals&&l.data.predicts?(he.value=l.data,te.value=Ve(e.endDate),l.data.maes&&(q.value=l.data.maes[0],Q.value=l.data.maes[1]),we.value=!0,me.value=!0):(te.value=Ve(e.endDate),a.value=e.predictBase64,ee.value=!0))},Ve=e=>{const a=new Date(e);return a.setDate(a.getDate()+1),`${a.getFullYear()}/${a.getMonth()+1}/${a.getDate()}`},De=e=>{if(console.log("chartRef.value data",e),!fe.value)return;if(!e)return;if(!e.datetimes)return;ye=M(fe.value);const a={title:{text:"实际值与预测值对比",textStyle:{fontSize:16}},tooltip:{trigger:"axis",formatter:function(e){return`\n          时间: ${e[0].axisValue}<br/>\n          实际值: ${e[0].data}<br/>\n          预测值: ${e[1].data}\n        `}},legend:{data:["实际值","预测值"]},xAxis:{type:"category",data:e.datetimes,axisLabel:{formatter:function(e){return e.split(" ")[1]}}},yAxis:{type:"value",name:"数值"},series:[{name:"实际值",type:"line",data:e.actuals.map(Number),smooth:!0,symbol:"circle",symbolSize:6,itemStyle:{color:"#5470C6"}},{name:"预测值",type:"line",data:e.predicts.map(Number),smooth:!0,symbol:"triangle",symbolSize:8,itemStyle:{color:"#EE6666"}}],grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0}};ye.setOption(a)};i((()=>{window.addEventListener("resize",Ye)})),o((()=>{ye&&ye.dispose(),window.removeEventListener("resize",Ye)}));const Ye=()=>{ye&&ye.resize()},Ce=t(1),_e=t(15),ke=t(0),Me=t(""),Se=e=>{_e.value=e,se()},ze=e=>{Ce.value=e,se()};k();const Ue=async()=>G.value?O.value&&J.value&&O.value>=J.value?(d.warning("结束时间要大于开始时间（2天及以上）"),O.value="",void(J.value="")):void 0:(d.warning("请先选择工厂"),O.value="",void(J.value="")),Be=async()=>G.value?W.value&&X.value&&W.value>X.value?(d.warning("开始时间不能大于结束时间"),W.value="",void(X.value="")):void 0:(d.warning("请先选择工厂"),W.value="",void(X.value=""));return(e,t)=>{const n=g("el-option"),i=g("el-select"),o=g("el-button"),k=g("el-date-picker"),M=g("el-table-column"),ne=g("el-tag"),de=g("el-table"),re=g("el-pagination"),pe=g("el-card"),ye=g("el-dialog"),he=g("el-icon"),Ve=g("el-image"),De=g("el-input-number"),Ye=g("el-checkbox");return f(),u(v,null,[s("div",S,[s("div",z,[s("div",U,[t[19]||(t[19]=s("span",{class:"promptspan"},"工厂名称：",-1)),r(i,{modelValue:G.value,"onUpdate:modelValue":t[0]||(t[0]=e=>G.value=e),placeholder:"请选择工厂名称",onChange:ie,clearable:"",filterable:""},{default:c((()=>[(f(!0),u(v,null,y(l.value,(e=>(f(),h(n,{key:e.dictCode,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),r(o,{type:"primary",onClick:t[1]||(t[1]=e=>(async()=>{if(!G.value)return void d.warning("请先选择工厂");let e=await _.alglist();200==e.code&&(H.value=e.data),ge.value=!0})())},{default:c((()=>t[18]||(t[18]=[p(" 新增训练任务 ")]))),_:1})]),t[23]||(t[23]=s("div",{class:"time-range-section"},null,-1)),s("div",B,[t[21]||(t[21]=s("span",{class:"promptspan"},"筛选时间范围：",-1)),r(k,{modelValue:W.value,"onUpdate:modelValue":t[2]||(t[2]=e=>W.value=e),type:"date",placeholder:"开始时间",onFocus:Be,style:{width:"100%","max-width":"180px"},"disabled-date":ve,align:"right"},null,8,["modelValue"]),t[22]||(t[22]=p(" 至 ")),r(k,{modelValue:X.value,"onUpdate:modelValue":t[3]||(t[3]=e=>X.value=e),type:"date","disabled-date":ve,placeholder:"结束时间",onFocus:Be,style:{width:"100%","max-width":"180px"},align:"right"},null,8,["modelValue"]),r(o,{type:"primary",onClick:t[4]||(t[4]=e=>(async()=>{if(G.value)if(W.value>X.value)d.warning("结束时间要大于等于开始时间");else try{await se()}catch(e){console.log("取消保存",e)}else d.warning("请先选择工厂名称")})()),title:"请选择1.工厂名称 2. 筛选时间范围"},{default:c((()=>t[20]||(t[20]=[p(" 筛选 ")]))),_:1})])]),s("div",L,[r(pe,{class:"original-list"},{header:c((()=>t[24]||(t[24]=[s("h2",null,"数据训练情况",-1)]))),default:c((()=>[s("div",N,[r(de,{data:ce.value,style:{width:"100%"},border:""},{default:c((()=>[r(M,{prop:"index",label:"序号",width:"60"},{default:c((({$index:e})=>[s("span",null,w(e+1+(Ce.value-1)*_e.value)+".",1)])),_:1}),r(M,{prop:"startDate",label:"开始时间"}),r(M,{prop:"endDate",label:"结束时间"}),r(M,{prop:"algName",label:"算法名"}),r(M,{prop:"trainStatus",label:"状态"},{default:c((({row:e})=>[r(ne,{type:oe(e.trainStatus)},{default:c((()=>[p(w(e.statusShow),1)])),_:2},1032,["type"])])),_:1}),r(M,{prop:"createTime",label:"训练时间"}),r(M,{label:"操作",width:"160"},{default:c((({row:e})=>["trained"==e.status?(f(),h(o,{key:0,type:"primary",size:"small",onClick:a=>be(e)},{default:c((()=>t[25]||(t[25]=[p(" 预测图 ")]))),_:2},1032,["onClick"])):x("",!0),"trained"==e.status?(f(),h(o,{key:1,type:"primary",size:"small",onClick:l=>(e=>{ae.value="权重分析",a.value=e.importanceBase64,ee.value=!0})(e)},{default:c((()=>t[26]||(t[26]=[p(" 权重图 ")]))),_:2},1032,["onClick"])):x("",!0)])),_:1})])),_:1},8,["data"]),r(re,{currentPage:Ce.value,"onUpdate:currentPage":t[5]||(t[5]=e=>Ce.value=e),"page-size":_e.value,total:ke.value,layout:"total,prev, pager, next",onSizeChange:Se,onCurrentChange:ze},null,8,["currentPage","page-size","total"])])])),_:1})])]),r(ye,{onOpened:xe,loading:we.value,modelValue:me.value,"onUpdate:modelValue":t[6]||(t[6]=e=>me.value=e),title:ae.value,width:"70%"},{default:c((()=>[s("div",$,[s("span",null,"预测日期: "+w(te.value),1),s("span",null,"预测和真实mae: "+w(q.value),1),s("span",null,"测量和真实mae: "+w(Q.value),1)]),s("div",{ref_key:"chartRef",ref:fe,style:{width:"100%",height:"680px"}},null,512)])),_:1},8,["loading","modelValue","title"]),r(ye,{modelValue:ee.value,"onUpdate:modelValue":t[7]||(t[7]=e=>ee.value=e),title:ae.value,width:"70%","before-close":e.handleClose},{default:c((()=>[s("div",E,[s("span",null,"预测日期:"+w(te.value),1),r(Ve,{src:"data:image/png;base64,"+a.value,fit:"cover","preview-src-list":["data:image/png;base64,"+a.value]},{error:c((()=>[s("div",F,[r(he,null,{default:c((()=>[r(b(V))])),_:1}),t[27]||(t[27]=s("span",null,"图片加载失败",-1))])])),_:1},8,["src","preview-src-list"])])])),_:1},8,["modelValue","title","before-close"]),r(ye,{modelValue:ge.value,"onUpdate:modelValue":t[17]||(t[17]=e=>ge.value=e),title:"选择算法",width:"70%","before-close":e.handleClose},{footer:c((()=>[s("span",A,[r(o,{onClick:t[15]||(t[15]=e=>ge.value=!1)},{default:c((()=>t[34]||(t[34]=[p("取消")]))),_:1}),r(o,{type:"primary",onClick:t[16]||(t[16]=e=>(async()=>{if(G.value)if(O.value)if(J.value)if(O.value>=J.value)d.warning("结束时间要大于开始时间（2天及以上）");else if(I.value)if(Z.value)if(le.value)try{await C.confirm("确定要用 算法("+I.value.name+") 训练"+ue.value+" ( "+le.value+" s)"+m(O.value).format("YYYY-MM-DD")+"至"+m(J.value).format("YYYY-MM-DD")+" 预测: ("+m(K.value).format("YYYY-MM-DD")+")"+Z.value+"次 的数据吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});let e=[I.value.id],a={trainStartDate:m(O.value).format("YYYY-MM-DD"),trainEndDate:m(K.value).format("YYYY-MM-DD"),company:G.value,file:Me.value,durationSecond:le.value,trainNo:Z.value,algIds:e},l=await _.executePythontrainv1(a);if(200==l.code&&(d.warning("已通知服务器开始训练，训练时间较长请耐心等待"),ge.value=!1,l.data&&l.data.warnData&&l.data.warnData.length>0)){let e="数据监测异常提示: "+l.data.noxColumn+"连续出现 "+l.data.warnLineNumber+" 条以上重复数据！重复起始时间分别为："+l.data.warnData;d.error({message:e,duration:1e4})}await se(),Me.value=""}catch(e){console.log("取消保存",e)}else d.warning("请输入时间跨度");else d.warning("请输入训练次数");else d.warning("请选择算法");else d.warning("请选择结束时间");else d.warning("请选择开始时间");else d.warning("请先选择工厂名称")})()),disabled:!I.value},{default:c((()=>t[35]||(t[35]=[p(" 训练 ")]))),_:1},8,["disabled"])])])),default:c((()=>[s("div",j,[t[28]||(t[28]=s("span",{class:"promptspan"},"工厂名称：",-1)),r(i,{modelValue:G.value,"onUpdate:modelValue":t[8]||(t[8]=e=>G.value=e),placeholder:"请选择工厂名称",onChange:ie,clearable:"",filterable:"",disabled:""},{default:c((()=>[(f(!0),u(v,null,y(l.value,(e=>(f(),h(n,{key:e.dictCode,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),s("div",R,[t[29]||(t[29]=s("span",{class:"promptspan"},"训练时间范围：",-1)),r(k,{modelValue:O.value,"onUpdate:modelValue":t[9]||(t[9]=e=>O.value=e),type:"date",placeholder:"开始时间",onFocus:Ue,style:{width:"100%","max-width":"180px"},"disabled-date":ve,align:"right"},null,8,["modelValue"]),t[30]||(t[30]=p(" 至 ")),r(k,{modelValue:J.value,"onUpdate:modelValue":t[10]||(t[10]=e=>J.value=e),type:"date","disabled-date":ve,placeholder:"结束时间",onFocus:Ue,style:{width:"100%","max-width":"180px"},align:"right"},null,8,["modelValue"]),t[31]||(t[31]=p(" 预测日期： ")),r(k,{modelValue:b(K),"onUpdate:modelValue":t[11]||(t[11]=e=>D(K)?K.value=e:null),type:"date",disabled:"",placeholder:"预测日期",style:{width:"100%","max-width":"180px"},align:"right"},null,8,["modelValue"])]),s("div",P,[t[32]||(t[32]=s("span",{class:"promptspan"},"次数：",-1)),r(De,{modelValue:Z.value,"onUpdate:modelValue":t[12]||(t[12]=e=>Z.value=e),min:1},null,8,["modelValue"]),t[33]||(t[33]=s("span",{class:"promptspan"},"时间跨度(s)：",-1)),r(De,{class:"duration-input",modelValue:le.value,"onUpdate:modelValue":t[13]||(t[13]=e=>le.value=e),placeholder:"Enter duration in seconds",min:1},null,8,["modelValue"])]),r(de,{data:H.value,style:{width:"100%"},onRowClick:e.handleRowClick,"row-class-name":e.tableRowClassName,"highlight-current-row":""},{default:c((()=>[r(M,{width:"60"},{default:c((({row:e})=>[r(Ye,{"model-value":I.value===e,onChange:a=>I.value=a?e:null,onClick:t[14]||(t[14]=Y((()=>{}),["stop"]))},null,8,["model-value","onChange"])])),_:1}),r(M,{prop:"index",label:"序号",width:"60"},{default:c((({$index:e})=>[s("span",null,w(e+1)+".",1)])),_:1}),r(M,{prop:"name",label:"算法名称",width:"180"}),r(M,{prop:"remark",label:"备注"})])),_:1},8,["data","onRowClick","row-class-name"]),I.value?(f(),u("div",T," 已选择: "+w(I.value.name)+" - (备注: "+w(I.value.remark)+") ",1)):x("",!0)])),_:1},8,["modelValue","before-close"])],64)}}},[["__scopeId","data-v-5cea1d9f"]]))}}}));
