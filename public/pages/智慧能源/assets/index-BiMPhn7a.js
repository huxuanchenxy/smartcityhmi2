import{a as w,G as we}from"./energyApi-BelWF7_m.js";import{_ as Ve,r as t,K as Fe,I as G,c as ke,e as p,b as l,w as o,C as Ce,d as s,o as D,i as m,t as z,y as O,N as xe,J as i}from"./index-CjguSdL3.js";const Ue={class:"container"},Pe={class:"select-area"},De={class:"content-area"},ze={class:"scrollable-list"},Se={class:"algorithm-management"},Be={class:"el-upload__tip"},Ee={class:"el-upload__tip"},Ne={class:"form-actions"},qe={__name:"index",setup(Re){t(""),t([]);const f=t(!1),V=t(!1),S=t(null),_=t(1),F=t(15),B=t(0),H=t([]),E=t("");Fe(()=>{const a=H.value.find(e=>e.dictValue===E.value);return a?a.dictLabel:""}),G(async()=>{await g()});const N=t([]),g=async()=>{let a=await w.algpage({company:E.value,pageNum:_.value,pageSize:F.value});a.code==200&&a.rows&&a.rows.length>0&&(B.value=a.total,N.value=a.rows.map((e,u)=>({...e})))};t([]),t([]),G(()=>{});function J(){V.value=!1,S.value=null,r.value={name:"",path:"",remark:""},h.value="",y.value="",f.value=!0}const j=async a=>{V.value=!0,S.value=a.id,h.value="",y.value="";let e=await w.algSingle({id:a.id});e.code==200&&(r.value={...e.data},e.data.trainPath&&(h.value=e.data.trainPath,r.value.algorithmFile=e.data.trainPath),e.data.predictPath&&(y.value=e.data.predictPath,r.value.algorithmFile2=e.data.predictPath),f.value=!0)},Q=async a=>{xe.confirm("确定要删除这条数据吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{w.algdel({id:a.id}).then(e=>{e.code==200?(i.success("删除成功"),g()):i.error("删除失败")})}).catch(()=>{i.info("已取消删除")})},r=t({name:"",path:"",remark:""}),X={name:[{required:!0,message:"请输入算法名称",trigger:"blur"}],algorithmFile:[{required:!0,message:"请上传训练算法文件",trigger:"change"}],algorithmFile2:[{required:!0,message:"请上传预测算法文件",trigger:"change"}]},U=t([]),q=t([]),Y=a=>{if(!a.raw.name.endsWith(".py"))return i.error("只能上传.py文件"),!1;r.value.algorithmFile=a.raw,c.value.validateField("algorithmFile",e=>{})},Z=()=>{U.value=[],r.value.algorithmFile=null,console.log(r.value),c.value.validateField("algorithmFile")},ee=a=>{if(!a.raw.name.endsWith(".py"))return i.error("只能上传.py文件"),!1;r.value.algorithmFile2=a.raw,c.value.validateField("algorithmFile2",e=>{})},ae=()=>{r.value.algorithmFile2=null,c.value.validateField("algorithmFile2")},k=t([]),C=t(!1),P=t(!1),le=t(null),d=t({id:"",name:"",no:"",value:""}),te=t(null),oe=()=>{if(!d.id||!d.name||!d.value){i.warning("请填写完整的参数信息");return}if(P.value){const a=k.value.findIndex(e=>e.id===le.value);a!==-1&&(k.value[a]={...d})}else{if(k.value.some(a=>a.id===d.id)){i.warning("该参数标识已存在");return}k.value.push({...d})}C.value=!1},c=t(null),ne=async()=>{try{await c.value.validate(),V.value?(await w.algupdate(r.value)).code==200&&(i.success("修改成功"),g()):(await w.algadd(r.value)).code==200&&(i.success("新增成功"),g()),f.value=!1}catch(a){i.error("请填写完整信息",a)}finally{}},re=()=>{f.value=!1},ue=a=>{F.value=a,g()},ie=a=>{_.value=a,g()};let de=we();const R=t(de+"/alg/upload"),I=t({Authorization:"Bearer your_token_here"}),se=t({type:"train"}),pe=t({type:"predict"}),L=t(Date.now()),T=t(Date.now()),h=t(""),y=t(""),me=(a,e,u)=>{a.code===200?(i.success("上传成功"),u.value=[{name:a.data,url:a.data,status:"success",percentage:100}],console.log("fileList:",u.value),h.value=a.data,r.value.trainPath=a.data):i.error(a.message||"上传失败")},ce=(a,e,u)=>{a.code===200?(i.success("上传成功"),u.value=[{name:a.data,url:a.data,status:"success",percentage:100}],console.log("fileList:",u.value),y.value=a.data,r.value.predictPath=a.data):i.error(a.message||"上传失败")},W=(a,e,u)=>{console.error("上传失败:",a),i.error("文件上传失败1")},A=()=>{U.value=[],q.value=[],L.value=Date.now(),T.value=Date.now()},ve=a=>(A(),a.name.endsWith(".py")?!0:(i.error("只能上传.py文件"),!1)),fe=a=>(A(),a.name.endsWith(".py")?!0:(i.error("只能上传.py文件"),!1)),ge=async()=>{var a;await Ce(),(a=c.value)==null||a.clearValidate()};return(a,e)=>{const u=s("el-button"),x=s("el-table-column"),_e=s("el-table"),he=s("el-pagination"),ye=s("el-card"),b=s("el-input"),v=s("el-form-item"),K=s("el-upload"),M=s("el-form"),$=s("el-dialog");return D(),ke("div",Ue,[p("div",Pe,[l(u,{type:"primary",onClick:J},{default:o(()=>e[9]||(e[9]=[m("新增算法")])),_:1})]),p("div",De,[l(ye,{class:"original-list"},{header:o(()=>e[10]||(e[10]=[p("h2",null,"算法配置",-1)])),default:o(()=>[p("div",ze,[l(_e,{data:N.value,style:{width:"100%"},border:""},{default:o(()=>[l(x,{prop:"index",label:"序号",width:"60"},{default:o(({$index:n})=>[p("span",null,z(n+1+(_.value-1)*F.value)+".",1)]),_:1}),l(x,{prop:"name",label:"算法名称"}),l(x,{prop:"remark",label:"备注"}),l(x,{label:"操作",width:"150"},{default:o(n=>[l(u,{size:"small",onClick:be=>j(n.row)},{default:o(()=>e[11]||(e[11]=[m("修改")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"danger",onClick:be=>Q(n.row)},{default:o(()=>e[12]||(e[12]=[m("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(he,{currentPage:_.value,"onUpdate:currentPage":e[0]||(e[0]=n=>_.value=n),"page-size":F.value,total:B.value,layout:"total,prev, pager, next",onSizeChange:ue,onCurrentChange:ie},null,8,["currentPage","page-size","total"])])]),_:1})]),l($,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=n=>f.value=n),title:V.value?"编辑算法":"新增算法",width:"60%",height:"80%",onOpen:ge},{default:o(()=>[p("div",Se,[l(M,{"label-width":"100px",model:r.value,rules:X,ref_key:"formRef",ref:c},{default:o(()=>[l(v,{label:"算法名称：",prop:"name"},{default:o(()=>[l(b,{modelValue:r.value.name,"onUpdate:modelValue":e[1]||(e[1]=n=>r.value.name=n),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(v,{label:"训练文件：",prop:"algorithmFile"},{default:o(()=>[(D(),O(K,{class:"upload-demo",action:R.value,headers:I.value,data:se.value,"before-upload":ve,"on-success":me,"on-error":W,"on-change":Y,"on-remove":Z,limit:1,"file-list":U.value,accept:".py","auto-upload":!0,key:L.value},{trigger:o(()=>[l(u,{type:"primary"},{default:o(()=>e[13]||(e[13]=[m("上传文件(训练)")])),_:1})]),tip:o(()=>[p("div",Be," 服务器训练文件:"+z(h.value),1)]),_:1},8,["action","headers","data","file-list"]))]),_:1}),l(v,{label:"预测文件：",prop:"algorithmFile2"},{default:o(()=>[(D(),O(K,{class:"upload-demo",action:R.value,headers:I.value,data:pe.value,"before-upload":fe,"on-success":ce,"on-error":W,"on-change":ee,"on-remove":ae,limit:1,"file-list":q.value,accept:".py","auto-upload":!0,key:T.value},{trigger:o(()=>[l(u,{type:"primary"},{default:o(()=>e[14]||(e[14]=[m("上传文件(预测)")])),_:1})]),tip:o(()=>[p("div",Ee," 服务器预测文件:"+z(y.value),1)]),_:1},8,["action","headers","data","file-list"]))]),_:1}),l(v,{label:"算法备注：",prop:"remark"},{default:o(()=>[l(b,{modelValue:r.value.remark,"onUpdate:modelValue":e[2]||(e[2]=n=>r.value.remark=n),type:"textarea",rows:3,placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),p("div",Ne,[l(u,{onClick:re},{default:o(()=>e[15]||(e[15]=[m("取消")])),_:1}),l(u,{type:"primary",onClick:ne},{default:o(()=>e[16]||(e[16]=[m("确定")])),_:1})]),l($,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=n=>C.value=n),title:P.value?"修改参数":"添加算法参数"},{footer:o(()=>[l(u,{onClick:e[6]||(e[6]=n=>C.value=!1)},{default:o(()=>e[17]||(e[17]=[m("取消")])),_:1}),l(u,{type:"primary",onClick:oe},{default:o(()=>e[18]||(e[18]=[m("确定")])),_:1})]),default:o(()=>[l(M,{model:d.value,"label-width":"100px",ref_key:"paramFormRef",ref:te},{default:o(()=>[l(v,{label:"参数标识：",prop:"id",required:""},{default:o(()=>[l(b,{modelValue:d.value.id,"onUpdate:modelValue":e[3]||(e[3]=n=>d.value.id=n),placeholder:"请输入",disabled:P.value},null,8,["modelValue","disabled"])]),_:1}),l(v,{label:"参数名称：",prop:"name",required:""},{default:o(()=>[l(b,{modelValue:d.value.name,"onUpdate:modelValue":e[4]||(e[4]=n=>d.value.name=n),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(v,{label:"参数值：",prop:"value",required:""},{default:o(()=>[l(b,{modelValue:d.value.value,"onUpdate:modelValue":e[5]||(e[5]=n=>d.value.value=n),placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])]),_:1},8,["modelValue","title"])])}}},Te=Ve(qe,[["__scopeId","data-v-18812d46"]]);export{Te as default};
